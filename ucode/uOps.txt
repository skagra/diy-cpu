// Definition of microcode operations in terms of control flags

// Send data to RAM
MEM<-MBR        MBR/OUT/XDATA | MEM/LD/XDATA

// Read data from RAM/ROM
MBR<-MEM        MEM/OUT/XDATA | MBR/LD/XDATA
IR<-MEM         MEM/OUT/XDATA | IR/LD/XDATA

// Set outgoing address 
MAR<-PC         PC/OUT/CADDR | MARH/LD/CADDRH | MARL/LD/CADDRL
MAR<-S          S/OUT/CADDR | MARL/LD/CADDRL | MARH/LD/CADDRH 
MARL<-MBR       MBR/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-MBR       MBR/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH
MARL<-ALU       ALUR/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-ALU       ALUR/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH
MARL<-A         A/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-A         A/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH
MARL<-X         X/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-X         X/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH
MARL<-Y         Y/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-Y         Y/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH
MARL<-STASHL    STASHL/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-STASHL    STASHL/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH
MARL<-STASHH    STASHH/OUT/CDATA | CDATA/TO/CADDRL | MARL/LD/CADDRL
MARH<-STASHH    STASHH/OUT/CDATA | CDATA/TO/CADDRH | MARH/LD/CADDRH

// Set outgoing data
MBR<-A          A/OUT/CDATA | MBR/LD/CDATA
MBR<-X          X/OUT/CDATA | MBR/LD/CDATA
MBR<-Y          Y/OUT/CDATA | MBR/LD/CDATA
MBR<-STASHL     STASHL/OUT/CDATA | MBR/LD/CDATA
MBR<-STASHH     STASHH/OUT/CDATA | MBR/LD/CDATA

// Move values into the PC (H/L)
PCL<-MBR        MBR/OUT/CDATA | PCL/LD/CDATA
PCH<-MBR        MBR/OUT/CDATA | PCH/LD/CDATA
PCL<-A          A/OUT/CDATA | PCL/LD/CDATA
PCH<-A          A/OUT/CDATA | PCH/LD/CDATA
PCL<-X          X/OUT/CDATA | PCL/LD/CDATA
PCH<-X          X/OUT/CDATA | PCH/LD/CDATA
PCL<-Y          Y/OUT/CDATA | PCL/LD/CDATA
PCH<-Y          Y/OUT/CDATA | PCH/LD/CDATA
PCL<-STASHL     STASHL/OUT/CDATA | PCL/LD/CDATA
PCH<-STASHH     STASHH/OUT/CDATA | PCH/LD/CDATA

// Increment the PC
PC-INC          PC/INC 

// Move incoming data to registers
A<-MBR          MBR/OUT/CDATA | A/LD/CDATA
X<-MBR          MBR/OUT/CDATA | X/LD/CDATA
Y<-MBR          MBR/OUT/CDATA | Y/LD/CDATA
STASHL<-MBR     MBR/OUT/CDATA | STASHL/LD/CDATA
STASHH<-MBR     MBR/OUT/CDATA | STASHH/LD/CDATA

// Move register into ALUA/B via the internal data bus
ALUA<-MBR       MBR/OUT/CDATA | ALUA/LD/CDATA
ALUB<-MBR       MBR/OUT/CDATA | ALUB/LD/CDATA
ALUA<-A         A/OUT/CDATA | ALUA/LD/CDATA
ALUA<-X         X/OUT/CDATA | ALUA/LD/CDATA
ALUA<-Y         X/OUT/CDATA | ALUA/LD/CDATA
ALUA<-STASHL    STASHL/OUT/CDATA | ALUA/LD/CDATA
ALUA<-STASHH    STASHH/OUT/CDATA | ALUA/LD/CDATA
ALUB<-A         A/OUT/CDATA | ALUB/LD/CDATA
ALUB<-Y         Y/OUT/CDATA | ALUB/LD/CDATA
ALUB<-X         X/OUT/CDATA | ALUB/LD/CDATA
ALUB<-STASHL    STASHL/OUT/CDATA | ALUB/LD/CDATA
ALUB<-STASHH    STASHH/OUT/CDATA | ALUB/LD/CDATA

// Set ALU C
ALUC<-0         ALUC/LD 
ALUC<-1         ALUC/LD | ALUC/SRC/0
ALUC<-PC        ALUC/LD | ALUC/SRC/1

// Move the output of the ALU into registers via the internal data bus
MBR<-ALU        ALUR/OUT/CDATA | MBR/LD/CDATA
A<-ALU          ALUR/OUT/CDATA | A/LD/CDATA
X<-ALU          ALUR/OUT/CDATA | X/LD/CDATA
Y<-ALU          ALUR/OUT/CDATA | Y/LD/CDATA
STASHL<-ALU     ALUR/OUT/CDATA | STASHL/LD/CDATA
STASHH<-ALU     ALUR/OUT/CDATA | STASHH/LD/CDATA

// ALU operations
ALUOP-AND       ZERO
ALUOP-OR        ALUOP/0
ALUOP-NOT       ALUOP/1 
ALUOP-XOR       ALUOP/1 | ALUOP/0
ALUOP-ADD       ALUOP/2 
ALUOP-SUB       ALUOP/2 | ALUOP/0
ALUOP-INC       ALUOP/2 | ALUOP/1
ALUOP-DEC       ALUOP/2 | ALUOP/1 | ALUOP/0

// Sources of P value
P/SRC-0        ZERO
P/SRC-1        P/SRC/0
P/SRC-ALU      P/SRC/1
P/SRC-CDATA    P/SRC/1 | P/SRC/0
